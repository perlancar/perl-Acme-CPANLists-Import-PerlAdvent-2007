<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by perltidy on Fri Dec  7 23:36:14 2007 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<title>2007 Perl Advent Calendar: Spoon!</title>
<link rel="stylesheet" href="../style.css" type="text/css" /></head>
<body>
<h1><a href="../">Perl Advent Calendar 2007-12</a>-11</h1>
<h2 align="center">Spoon!</H2>
<h3 align="center">by Jerrad Pierce</h3>

<blockquote style="padding: 1em; border: 2px ridge black; background-color:#eee">
My apologies for the gaps in the calendar. The elves have been occupied, and I've been up for 48 hours working on term papers but have decided to take a quick break.
</blockquote>

<p><tt><a href="http://search.cpan.org/search?module=forks">forks</a></tt>
is an XS-based module which serves as a drop-in replacement for
<tt>threads</tt>. This can be handy in the event that your platform or build
of perl doesn't support threads. To make use of the module simply:

<pre>
nick@nog% perl -pi~ -e 's/\bthreads\b/forks/ .. 0' script
</pre>

<p>And that's all there is to it! Alternatively, the installer gives you the
option of installing stubs in place of (the non-existent) <tt>threads</tt>
and <tt>threads:shared </tt>so that you can <tt>use forks</tt> transparently.
</p>

<p>In my cursory review of the module&mdash;15% of the tests failed, and the
sample code ran regardless&mdash;I noticed one small difference between
ithreads and <tt>forks</tt>. Whereas ithreads emits the following when
executing the sample code:</p>

<pre><span class="c">A thread exited while 4 other threads were still running.</span></pre>

<tt>forks</tt> offers a bit more detail&hellip;

<pre><span class="c">Perl exited with active threads:
        1 running and unjoined
        2 finished and unjoined
        0 running and detached</span></pre>

<h1><a href="mod11.pl">mod11.pl</a></h1>
<hr />
<pre>
   1 <span class="c">#lifted from perlthrtut</span>
   2 <span class="k">use</span> <span class="w">forks</span><span class="sc">;</span>
   3 
<a name="loop-"></a>   4 <span class="k">sub </span><span class="m">loop</span> <span class="s">{</span>
   5         <span class="k">my</span> <span class="i">$thread</span> = <span class="k">shift</span><span class="sc">;</span>
   6         <span class="k">my</span> <span class="i">$foo</span> = <span class="n">50</span><span class="sc">;</span>
   7         <span class="k">while</span><span class="s">(</span><span class="i">$foo</span>--<span class="s">)</span> <span class="s">{</span> <span class="k">print</span> <span class="q">&quot;in thread $thread\n&quot;</span> <span class="s">}</span>
   8         <span class="w">threads</span><span class="w">-&gt;yield</span><span class="sc">;</span>
   9         <span class="i">$foo</span> = <span class="n">50</span><span class="sc">;</span>
  10         <span class="k">while</span><span class="s">(</span><span class="i">$foo</span>--<span class="s">)</span> <span class="s">{</span> <span class="k">print</span> <span class="q">&quot;in thread $thread\n&quot;</span> <span class="s">}</span>
  11 <span class="s">}</span>
  12 
  13 <span class="k">my</span> <span class="i">$thread1</span> = <span class="w">threads</span><span class="w">-&gt;new</span><span class="s">(</span>\<span class="i">&amp;loop</span><span class="cm">,</span> <span class="q">'first'</span><span class="s">)</span><span class="sc">;</span>
  14 <span class="k">my</span> <span class="i">$thread2</span> = <span class="w">threads</span><span class="w">-&gt;new</span><span class="s">(</span>\<span class="i">&amp;loop</span><span class="cm">,</span> <span class="q">'second'</span><span class="s">)</span><span class="sc">;</span>
  15 <span class="k">my</span> <span class="i">$thread3</span> = <span class="w">threads</span><span class="w">-&gt;new</span><span class="s">(</span>\<span class="i">&amp;loop</span><span class="cm">,</span> <span class="q">'third'</span><span class="s">)</span><span class="sc">;</span>
</pre>
</body>
</html>
