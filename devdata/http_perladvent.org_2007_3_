<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by perltidy on Thu Nov 30 18:10:54 2006 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>2007 Perl Advent Calendar: Brown paper packages tied up with string</title>
<link rel="stylesheet" href="../style.css" type="text/css" /></head>
<body>
<h1><a href="../">Perl Advent Calendar 2007-12</a>-03</h1>
<h2 align="center">Brown paper packages tied up with string</h2>
<h3 align="center">by Jason Porritt</h3>

<blockquote style="padding: 1em; border: 2px ridge black; background-color:#eee">
Thanks for this timely submission Jason. &mdash; The Management
</blockquote>

<p>Time is precious around the holiday season. Instead of spending hours wrapping DBI calls with timers and warn statements to figure out which of your fifty-odd queries is slow today, give <tt><a href="http://search.cpan.org/search?module=DBIx::Profile">DBIx::Profile</a></tt> a try. Like the customer service counter at a department store, <tt>DBIx::Profile</tt> will take care of all your wrapping needs, reporting wall-clock and CPU time as well as the execute and fetch count for your DBI interactions.</p>

<p>All you have to do is <tt>use</tt> it before DBI itself:</p>
<pre>
   1 <span class="k">use</span> <span class="w">DBIx::Profile</span><span class="sc">;</span>
   2 <span class="k">use</span> <span class="w">DBI</span><span class="sc">;</span>
   3 <span class="i">$dbh</span><span class="i">-&gt;setLogFile</span><span class="s">(</span><span class="q">&quot;Yule.log&quot;</span><span class="s">)</span><span class="sc">;</span> <span class="c">#optional -- default STDERR</span>
   4 <span class="i">$dbh</span><span class="i">-&gt;printProfile</span><span class="sc">;</span>           <span class="c">#optional -- default is to buffer</span>
</pre>

<p>I prefer to include it in my Apache config file&mdash;</p>
<pre>
   <span class="w">PerlModule DBIx::Profile</span>
   <span class="c">PerlModule Apache::DBI</span>
</pre>
<p>&mdash;adding one line provides reporting for every application, content filter, or authentication handler on the entire site. By default, <tt>DBIx::Profile</tt> will print everything to <tt>STDERR</tt> when it disconnects from the database, though you can select a different file via <tt>$dbh-&gt;setLogFile(&quot;Yule.log&quot;);</tt> or explicitly print the data at any time using <tt>$dbh-&gt;printProfile;</tt>.</p>

<p>With all that in place, run your script, watch the output and pass out lumps of coal accordingly. You might make use of all the time you saved to get ahead on your shopping!</p>

<h2>Example output</h2>
<pre>
<span class="c">=================================================================
7677 "SELECT *
      FROM employee
      WHERE UPPER(last_name) NOT LIKE 'KRINGLE'"   Total wall clock time: 0.0100
08s 
   execute ---------------------------------------
      Total
         Count        :         10
         Wall Clock   :  0.0066130 s    0.0006613 s
         Cpu Time     :  0.0000000 s    0.0000000 s
      returned 0E0
         Count        :         10
         Wall Clock   :  0.0066130 s    0.0006613 s
         Cpu Time     :  0.0000000 s    0.0000000 s
   fetchrow_hashref ---------------------------------------
      Total
         Count        :         58
         Wall Clock   :  0.0033950 s    0.0000585 s
         Cpu Time     :  0.0000000 s    0.0000000 s
      first
         Count        :         10
         Wall Clock   :  0.0010850 s    0.0001085 s
         Cpu Time     :  0.0000000 s    0.0000000 s
      no more rows
         Count        :         10
         Wall Clock   :  0.0004970 s    0.0000497 s
         Cpu Time     :  0.0000000 s    0.0000000 s
      normal
         Count        :         38
         Wall Clock   :  0.0018130 s    0.0000477 s
         Cpu Time     :  0.0000000 s    0.0000000 s
</span>
</pre>

</body>
</html>
