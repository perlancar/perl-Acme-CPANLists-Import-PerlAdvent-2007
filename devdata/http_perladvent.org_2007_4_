<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by perltidy on Wed Nov 28 23:00:07 2007 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>2007 Perl Advent Calendar: You don't get a belly like this drinking skim milk</title>
<link rel="stylesheet" href="../style.css" type="text/css" />
</head>
<body>
<h1><a href="../">Perl Advent Calendar 2007-12</a>-04</h1>
<h2 align="center">You don't get a belly like this drinking skim milk</h2>
<h3 align="center">by Josh McAdams</h3>

<p>Santa is a big ball of cheer, but he didn't get so big by going light on the treats that all of the children set out for him on Christmas Eve.  To help Santa check up on the snacks that are left for him, we'll use <tt><a href="http://search.cpan.org/search?module=Test::Differences">Test::Differences</a></tt> to highlight the differences in the complex data structures that Santa uses to keep track of the treats he expects to receive and those that his elves report to him while scouting the field.</p>

<p>Of course, Santa is not the only one checking his list on Christmas.  All of the children need a way to compare the multiline scalar list of toys they wanted to the scalar list of toys they received.</p>

<p><tt>Test::Differences</tt> is a module that picks up where <tt>Test::More::is_deeply</tt> leaves off.  It can compare complex data structures and multiline strings, showing the data that was expected and what was gotten side-by-side for easy review.  If you're worried about too much output, don't.  You can set the amount of context shown around the differences so that the entire data structures that you diff don't get printed.</p>

<h2 style="float:right"><a href="mod4.pl">mod4.pl</a></h2>
<pre>
   1 <span class="k">use</span> <span class="w">Test::More</span> <span class="w">tests</span> <span class="cm">=&gt;</span> <span class="n">1</span><span class="sc">;</span>
   2 <span class="k">use</span> <span class="w">Test::Differences</span><span class="sc">;</span>
   3 
   4 <span class="k">my</span> <span class="i">$expected</span> =
   5   <span class="s">{</span> <span class="w">cookies</span> <span class="cm">=&gt;</span> <span class="s">[</span><span class="q">qw(oatmeal lemondrop)</span><span class="s">]</span><span class="cm">,</span> <span class="w">milk</span> <span class="cm">=&gt;</span> <span class="s">[</span><span class="q">qw(whole chocolate)</span><span class="s">]</span> <span class="s">}</span><span class="sc">;</span>
   6 <span class="k">my</span> <span class="i">$got</span> = <span class="s">{</span> <span class="w">cookies</span> <span class="cm">=&gt;</span> <span class="s">[</span><span class="q">qw(oatmeal lemondrop)</span><span class="s">]</span><span class="cm">,</span> <span class="w">milk</span> <span class="cm">=&gt;</span> <span class="s">[</span><span class="q">qw(skim chocolate)</span><span class="s">]</span> <span class="s">}</span><span class="sc">;</span>
   7 
   8 <span class="w">eq_or_diff</span> <span class="i">$got</span><span class="cm">,</span> <span class="i">$expected</span><span class="cm">,</span> <span class="q">&quot;Santa&#39;s treats&quot;</span><span class="sc">;</span>
   9 
  10 <span class="i">$expected</span> = <span class="q">&quot;Baseball bat\nComic books\niPod\n&quot;</span><span class="sc">;</span>
  11 <span class="i">$got</span>      = <span class="q">&quot;Baseball bat\nComic books\nZune\n&quot;</span><span class="sc">;</span>
  12 
  13 <span class="w">eq_or_diff</span> <span class="i">$got</span><span class="cm">,</span> <span class="i">$expected</span><span class="cm">,</span> <span class="q">&#39;x-mas list&#39;</span><span class="sc">;</span>
</pre>

<pre>
<span class="c">1..1
not ok 1 - Santa's treats
#   Failed test 'Santa's treats'
#   at mod4.pl line 11.
# +----+-----------------+-----------------+
# | Elt|Got              |Expected         |
# +----+-----------------+-----------------+
# |   0|{                |{                |
# |   1|  cookies => [   |  cookies => [   |
# |   2|    'oatmeal',   |    'oatmeal',   |
# |   3|    'lemondrop'  |    'lemondrop'  |
# |   4|  ],             |  ],             |
# |   5|  milk => [      |  milk => [      |
# *   6|    'skim',      |    'whole',     *
# |   7|    'chocolate'  |    'chocolate'  |
# |   8|  ]              |  ]              |
# |   9|}                |}                |
# +----+-----------------+-----------------+
not ok 2 - x-mas list
#   Failed test 'x-mas list'
#   at mod4.pl line 16.
# +---+--------------+--------------+
# | Ln|Got           |Expected      |
# +---+--------------+--------------+
# |  1|Baseball bat  |Baseball bat  |
# |  2|Comic books   |Comic books   |
# *  3|Zune          |iPod          *
# +---+--------------+--------------+
# Looks like you planned 1 test but ran 1 extra.
# Looks like you failed 2 tests of 2 run.
</span></pre>

<p>
As you can see, <tt>Test::Differences</tt> gives you quite a bit more power and information than <tt>Test::More::is_deeply</tt> does, yet it works on the same <tt>Test::Builder</tt> framework, so it works flawlessly with all of the standard Perl testing modules that you are used to.</p>

</body>
</html>
